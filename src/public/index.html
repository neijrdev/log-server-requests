<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Axios Logs</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }

      h1 {
        text-align: center;
      }

      .log-entry {
        border: 1px solid #ddd;
        margin: 10px auto;
        width: 90%;
        border-radius: 4px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .log-summary {
        display: flex;
        align-items: center;
        padding: 10px;
        background-color: #f1f1f1;
        cursor: pointer;
        user-select: none;
      }

      .expand-icon {
        margin-right: 10px;
        cursor: pointer;
      }

      .type-tag {
        background-color: #e0e0e0;
        color: #333;
        padding: 2px 6px;
        border-radius: 4px;
        margin-right: 5px;
        text-transform: uppercase;
        font-size: 12px;
      }

      .method-tag {
        padding: 2px 6px;
        border-radius: 4px;
        color: #fff;
        margin-right: 5px;
        text-transform: uppercase;
        font-size: 12px;
      }

      .method-tag.get {
        background-color: #4caf50; /* Green */
      }

      .method-tag.post {
        background-color: #2196f3; /* Blue */
      }

      .method-tag.put {
        background-color: #ff9800; /* Orange */
      }

      .method-tag.delete {
        background-color: #f44336; /* Red */
      }

      .method-tag.other {
        background-color: #9e9e9e; /* Grey */
      }

      .status-tag {
        background-color: #e0e0e0;
        color: #333;
        padding: 2px 6px;
        border-radius: 4px;
        margin-right: 5px;
        font-size: 12px;
      }

      .url-text {
        color: #000;
        font-size: 12px;
        word-break: break-all;
      }

      .log-details {
        display: none;
        font-size: 12px;
        background-color: #fff;
      }

      .details-container {
        padding: 10px;
      }

      /* Estilo para as abas */
      .tab-menu {
        display: flex;
        border-bottom: 1px solid #ccc;
      }

      .tab-menu button {
        background: none;
        border: none;
        padding: 10px 15px;
        cursor: pointer;
        font-size: 14px;
      }

      .tab-menu button.active {
        border-bottom: 2px solid #2196f3;
        color: #2196f3;
      }

      .tab-content {
        display: none;
        font-family: "Courier New", Courier, monospace;
        overflow-x: auto;
      }

      .tab-content.active {
        display: block;
      }

      /* Estilo para tabelas */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }

      th,
      td {
        text-align: left;
        padding: 8px;
        border-bottom: 1px solid #ddd;
        font-family: "Courier New", Courier, monospace;
      }

      th {
        background-color: #f9f9f9;
        font-weight: bold;
      }

      /* Estilo para JSON com syntax highlighting */
      .json-viewer {
        white-space: pre-wrap;
        font-family: "Courier New", Courier, monospace;
        background-color: #fff;
        padding: 10px;
        border-radius: 4px;
        border: 1px solid #e1e4e8;
        color: #333;
      }

      .json-key {
        color: #92278f; /* Roxo para chaves */
      }

      .json-string {
        color: #3ab54a; /* Verde para strings */
      }

      .json-number {
        color: #25aae1; /* Azul para números */
      }

      .json-boolean {
        color: #f9826c; /* Laranja para booleanos */
      }

      .json-null {
        color: #f9826c; /* Laranja para null */
      }

      .json-brace {
        color: #555; /* Cinza para chaves e colchetes */
      }

      .json-comma {
        color: #555; /* Cinza para vírgulas */
      }
    </style>
  </head>
  <body>
    <h1>Logs das Requisições e Respostas</h1>
    <div id="logs"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();

      // Listener para eventos 'log'
      socket.on("log", (logData) => {
        const logContainer = document.getElementById("logs");

        // Cria o elemento do log
        const logEntry = document.createElement("div");
        logEntry.classList.add("log-entry");

        // Cria a linha resumida
        const logSummary = document.createElement("div");
        logSummary.classList.add("log-summary");

        // Cria o ícone de expandir/recolher
        const expandIcon = document.createElement("span");
        expandIcon.classList.add("expand-icon");
        expandIcon.textContent = "▶";

        const type = logData.type.toUpperCase();
        const method = (
          logData.logData.method ||
          (logData.logData.config && logData.logData.config.method) ||
          ""
        ).toUpperCase();
        const status = logData.logData.status || "";
        const url =
          logData.logData.url ||
          (logData.logData.config && logData.logData.config.url) ||
          "";

        // Cria as tags
        const typeTag = document.createElement("span");
        typeTag.classList.add("type-tag");
        typeTag.textContent = type;

        const methodTag = document.createElement("span");
        const methodLower = method.toLowerCase();
        const validMethods = ["get", "post", "put", "delete"];
        const methodClass = validMethods.includes(methodLower)
          ? methodLower
          : "other";
        methodTag.classList.add("method-tag", methodClass);
        methodTag.textContent = method;

        const statusTag = document.createElement("span");
        statusTag.classList.add("status-tag");
        statusTag.textContent = status;

        const urlText = document.createElement("span");
        urlText.classList.add("url-text");
        urlText.textContent = url;

        // Monta a linha resumida
        logSummary.appendChild(expandIcon);
        logSummary.appendChild(typeTag);
        logSummary.appendChild(methodTag);
        if (status) {
          logSummary.appendChild(statusTag);
        }
        logSummary.appendChild(urlText);

        // Cria a seção de detalhes
        const logDetails = document.createElement("div");
        logDetails.classList.add("log-details");

        // Cria o container dos detalhes
        const detailsContainer = document.createElement("div");
        detailsContainer.classList.add("details-container");

        // Cria as abas
        const tabMenu = document.createElement("div");
        tabMenu.classList.add("tab-menu");

        const tabs = [];

        // Função auxiliar para criar uma aba
        function createTab(title, contentElement) {
          const tabButton = document.createElement("button");
          tabButton.textContent = title;
          tabButton.addEventListener("click", () => {
            tabs.forEach((t) => {
              t.button.classList.remove("active");
              t.content.classList.remove("active");
            });
            tabButton.classList.add("active");
            contentElement.classList.add("active");
          });
          tabMenu.appendChild(tabButton);
          tabs.push({ button: tabButton, content: contentElement });
        }

        // Abas para REQUEST e RESPONSE
        if (type === "REQUEST") {
          // Headers
          const headersContent = document.createElement("div");
          headersContent.classList.add("tab-content");
          const headers = logData.logData.headers || {};
          headersContent.appendChild(createTableFromObject(headers));
          createTab("Headers", headersContent);

          // Config
          const configContent = document.createElement("div");
          configContent.classList.add("tab-content");
          configContent.appendChild(createHighlightedJSON(logData.logData));
          createTab("Config", configContent);
        }

        if (type === "RESPONSE") {
          // Headers
          const headersContent = document.createElement("div");
          headersContent.classList.add("tab-content");
          const headers = logData.logData.headers || {};
          headersContent.appendChild(createTableFromObject(headers));
          createTab("Headers", headersContent);

          // Data
          const dataContent = document.createElement("div");
          dataContent.classList.add("tab-content");
          dataContent.appendChild(createHighlightedJSON(logData.logData.data));
          createTab("Response", dataContent);

          // Config
          const configContent = document.createElement("div");
          configContent.classList.add("tab-content");
          configContent.appendChild(
            createHighlightedJSON(logData.logData.config)
          );
          createTab("Config", configContent);
        }

        // Ativa a primeira aba por padrão
        if (tabs.length > 0) {
          tabs[0].button.classList.add("active");
          tabs[0].content.classList.add("active");
        }

        // Monta o container dos detalhes
        detailsContainer.appendChild(tabMenu);
        tabs.forEach((t) => {
          detailsContainer.appendChild(t.content);
        });

        logDetails.appendChild(detailsContainer);

        // Toggle dos detalhes ao clicar na linha resumida
        logSummary.addEventListener("click", () => {
          if (logDetails.style.display === "none") {
            logDetails.style.display = "block";
            expandIcon.textContent = "▼";
          } else {
            logDetails.style.display = "none";
            expandIcon.textContent = "▶";
          }
        });

        logEntry.appendChild(logSummary);
        logEntry.appendChild(logDetails);

        logContainer.appendChild(logEntry);
      });

      // Função para criar uma tabela a partir de um objeto
      function createTableFromObject(obj) {
        const table = document.createElement("table");
        const thead = document.createElement("thead");
        const tbody = document.createElement("tbody");

        const headerRow = document.createElement("tr");
        const thKey = document.createElement("th");
        thKey.textContent = "Key";
        const thValue = document.createElement("th");
        thValue.textContent = "Value";
        headerRow.appendChild(thKey);
        headerRow.appendChild(thValue);
        thead.appendChild(headerRow);

        for (const key in obj) {
          const row = document.createElement("tr");
          const tdKey = document.createElement("td");
          tdKey.textContent = key;
          const tdValue = document.createElement("td");
          tdValue.textContent = obj[key];
          row.appendChild(tdKey);
          row.appendChild(tdValue);
          tbody.appendChild(row);
        }

        table.appendChild(thead);
        table.appendChild(tbody);

        return table;
      }

      // Função para criar um visualizador de JSON com syntax highlighting
      function createHighlightedJSON(jsonData) {
        const pre = document.createElement("pre");
        pre.classList.add("json-viewer");
        pre.innerHTML = syntaxHighlight(JSON.stringify(jsonData, null, 2));
        return pre;
      }

      // Função para aplicar syntax highlighting em JSON
      function syntaxHighlight(json) {
        json = json
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
        return json.replace(
          /("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|\b\d+\.?\d*\b|\{|\}|\[|\]|,)/g,
          function (match) {
            let cls = "json-number";
            if (/^"/.test(match)) {
              if (/:$/.test(match)) {
                cls = "json-key";
              } else {
                cls = "json-string";
              }
            } else if (/true|false/.test(match)) {
              cls = "json-boolean";
            } else if (/null/.test(match)) {
              cls = "json-null";
            } else if (/\{|\}|\[|\]/.test(match)) {
              cls = "json-brace";
            } else if (/\,/.test(match)) {
              cls = "json-comma";
            }
            return '<span class="' + cls + '">' + match + "</span>";
          }
        );
      }
    </script>
  </body>
</html>
